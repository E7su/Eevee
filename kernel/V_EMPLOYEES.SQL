-- Author:            Artem Glotov
-- Date of creation:  01.04.2016
-- Description:       Employees

CREATE OR REPLACE VIEW JIRA_READER.V_EMPLOYEES AS
  SELECT
    j.ID                                 ID,
    c8.STRINGVALUE                       LOGIN,
    cu.LAST_NAME || ' ' || cu.FIRST_NAME EMPLOYEE,
    j.SUMMARY                            SUMMARY -- TODO DEPRECATED
  FROM JIRA.JIRAISSUE j
    INNER JOIN JIRA.PROJECT p ON (j.PROJECT = p.ID AND p.PKEY = 'EMP')
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c8 ON (c8.ISSUE = j.ID AND c8.CUSTOMFIELD = 13070) -- EMPLOYEE LOGIN
    LEFT JOIN JIRA.APP_USER au ON (au.USER_KEY = c8.STRINGVALUE)
    LEFT JOIN JIRA.CWD_USER cu ON (cu.LOWER_USER_NAME = au.LOWER_USER_NAME);

COMMENT ON COLUMN JIRA_READER.V_EMPLOYEES.ID IS 'ID';
COMMENT ON COLUMN JIRA_READER.V_EMPLOYEES.LOGIN IS 'Логин';
COMMENT ON COLUMN JIRA_READER.V_EMPLOYEES.EMPLOYEE IS 'Сотрудник';
COMMENT ON COLUMN JIRA_READER.V_EMPLOYEES.Summary IS 'Название';
