-- Author:            Polina Azarova
-- Date of creation:  11.08.2016
-- Description:       Device registration

CREATE OR REPLACE VIEW JIRA_READER.V_DEVICES AS
  SELECT
    j.ID            ID,
    j.SUMMARY       SUMMARY,
    c5.STRINGVALUE  SERIAL_NUMBER,
    j.ASSIGNEE      ASSIGNEE,
    j.DESCRIPTION   DESCRIPTION,
    t.PNAME         DEVICE_TYPE,
    o1.CUSTOMVALUE  COMPUTER_TYPE,
    o2.CUSTOMVALUE  MEMORY,
    o6.CUSTOMVALUE  HAS_SSD,
    o3.CUSTOMVALUE  MONITOR_TYPE,
    o4.CUSTOMVALUE  NOTEBOOK_TYPE,
    o7.CUSTOMVALUE  IS_SELF
  FROM JIRA.JIRAISSUE j
    INNER JOIN JIRA.PROJECT p ON (p.ID = j.PROJECT AND p.ID = 14285) --p.PKEY = 'DEVICE')
    LEFT JOIN JIRA.ISSUETYPE t ON (t.id = j.ISSUETYPE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c5 ON (c5.ISSUE = j.ID AND c5.CUSTOMFIELD = 13777)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c1 ON (c1.ISSUE = j.ID AND c1.CUSTOMFIELD = 13780)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o1 ON (TO_CHAR(o1.ID) = c1.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c2 ON (c2.ISSUE = j.ID AND c2.CUSTOMFIELD = 13778)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o2 ON (TO_CHAR(o2.ID) = c2.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c3 ON (c3.ISSUE = j.ID AND c3.CUSTOMFIELD = 13782)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o3 ON (TO_CHAR(o3.ID) = c3.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c4 ON (c4.ISSUE = j.ID AND c4.CUSTOMFIELD = 13781)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o4 ON (TO_CHAR(o4.ID) = c4.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c6 ON (c6.ISSUE = j.ID AND c6.CUSTOMFIELD = 13779)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o6 ON (TO_CHAR(o6.ID) = c6.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c7 ON (c7.ISSUE = j.ID AND c7.CUSTOMFIELD = 13783)
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o7 ON (TO_CHAR(o7.ID) = c7.STRINGVALUE);

COMMENT ON COLUMN V_DEVICES.ID IS 'ID';
COMMENT ON COLUMN V_DEVICES.SUMMARY IS 'Заголовок';
COMMENT ON COLUMN V_DEVICES.SERIAL_NUMBER IS 'Серийный номер';
COMMENT ON COLUMN V_DEVICES.ASSIGNEE IS 'Владелец';
COMMENT ON COLUMN V_DEVICES.DESCRIPTION IS 'Описание';
COMMENT ON COLUMN V_DEVICES.DEVICE_TYPE IS 'Тип устройства';
COMMENT ON COLUMN V_DEVICES.COMPUTER_TYPE IS 'Тип компьютера';
COMMENT ON COLUMN V_DEVICES.MEMORY IS 'Память';
COMMENT ON COLUMN V_DEVICES.HAS_SSD IS 'Есть SSD';
COMMENT ON COLUMN V_DEVICES.MONITOR_TYPE IS 'Тип монитора';
COMMENT ON COLUMN V_DEVICES.NOTEBOOK_TYPE IS 'Тип ноутбука';
COMMENT ON COLUMN V_DEVICES.IS_SELF IS 'Личный';
