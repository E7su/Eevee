-- Author:            Polina Azarova
-- Date of creation:  11.08.2016
-- Description:       Device registration

CREATE OR REPLACE VIEW JIRA_READER.V_DEVICES AS
  SELECT
    j.ID           ID,
    j.ISSUENUM     ISSUENUM,
    j.SUMMARY      SUMMARY,
    c5.STRINGVALUE SERIAL_NUMBER,
    j.DESCRIPTION  DESCRIPTION,
    j.ISSUETYPE    DEVICE_TYPE,
    o1.CUSTOMVALUE COMPUTER_TYPE,
    o1.SEQUENCE    COMPUTER_TYPE_SEQ,
    o2.CUSTOMVALUE MEMORY,
    o6.CUSTOMVALUE HAS_SSD,
    o3.CUSTOMVALUE MONITOR_TYPE,
    o3.SEQUENCE    MONITOR_TYPE_SEQ,
    o4.CUSTOMVALUE NOTEBOOK_TYPE,
    o4.SEQUENCE    NOTEBOOK_TYPE_SEQ,
    o7.CUSTOMVALUE IS_SELF,
    c8.STRINGVALUE EMPLOYEE_LOGIN,
    c9.STRINGVALUE RESPONSIBLE_LOGIN
  FROM JIRA.JIRAISSUE j
    INNER JOIN JIRA.PROJECT p ON (p.ID = j.PROJECT AND p.ID = 14285) --p.PKEY = 'DEVICE')
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c1 ON (c1.ISSUE = j.ID AND c1.CUSTOMFIELD = 13780) -- COMPUTER_TYPE
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o1 ON (TO_CHAR(o1.ID) = c1.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c2 ON (c2.ISSUE = j.ID AND c2.CUSTOMFIELD = 13778) -- MEMORY
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o2 ON (TO_CHAR(o2.ID) = c2.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c3 ON (c3.ISSUE = j.ID AND c3.CUSTOMFIELD = 13782) -- MONITOR_TYPE
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o3 ON (TO_CHAR(o3.ID) = c3.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c4 ON (c4.ISSUE = j.ID AND c4.CUSTOMFIELD = 13781) -- NOTEBOOK_TYPE
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o4 ON (TO_CHAR(o4.ID) = c4.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c5 ON (c5.ISSUE = j.ID AND c5.CUSTOMFIELD = 13777) -- SERIAL_NUMBER
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c6 ON (c6.ISSUE = j.ID AND c6.CUSTOMFIELD = 13779) -- HAS_SSD
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o6 ON (TO_CHAR(o6.ID) = c6.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c7 ON (c7.ISSUE = j.ID AND c7.CUSTOMFIELD = 13783) -- IS_SELF
    LEFT JOIN JIRA.CUSTOMFIELDOPTION o7 ON (TO_CHAR(o7.ID) = c7.STRINGVALUE)
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c8 ON (c8.ISSUE = j.ID AND c8.CUSTOMFIELD = 13070) -- EMPLOYEE_LOGIN
    LEFT JOIN JIRA.CUSTOMFIELDVALUE c9 ON (c9.ISSUE = j.ID AND c9.CUSTOMFIELD = 13986);-- RESPONSIBLE_LOGIN

COMMENT ON COLUMN JIRA_READER.V_DEVICES.ID IS 'ID';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.ISSUENUM IS 'Номер';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.SUMMARY IS 'Заголовок';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.SERIAL_NUMBER IS 'Серийный номер';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.DESCRIPTION IS 'Описание';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.DEVICE_TYPE IS 'Тип устройства';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.COMPUTER_TYPE IS 'Тип компьютера';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.COMPUTER_TYPE_SEQ IS 'Номер типа компьютера';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.MEMORY IS 'Память';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.HAS_SSD IS 'Есть SSD';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.MONITOR_TYPE IS 'Тип монитора';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.MONITOR_TYPE_SEQ IS 'Номер типа монитора';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.NOTEBOOK_TYPE IS 'Тип ноутбука';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.NOTEBOOK_TYPE_SEQ IS 'Номер типа ноутбука';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.IS_SELF IS 'Личный';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.EMPLOYEE_LOGIN IS 'Сотрудник';
COMMENT ON COLUMN JIRA_READER.V_DEVICES.RESPONSIBLE_LOGIN IS 'Ответственный';
